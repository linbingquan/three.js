<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>厨房三维家电</title>
    <script src="./build/three.min.js"></script>
    <script src="./examples/js/WebGL.js"></script>
    <script src="./examples/js/controls/OrbitControls.js"></script>
    
    <script src="./examples/js/libs/inflate.min.js"></script>
    <!-- <script src="../../examples/js/loaders/NRRDLoader.js"></script> -->
    <script src="./examples/js/curves/NURBSCurve.js"></script>
    <script src="./examples/js/curves/NURBSUtils.js"></script>
    <script src="./examples/js/loaders/FBXLoader.js"></script>
    <script src="./examples/js/objects/Reflector.js"></script>
    <script src="./examples/js/libs/stats.min.js"></script>
    <script src="./examples/js/libs/tween.min.js"></script>
    <script type="text/javascript" src="./js/vue.min.js"></script>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <style>
        body { overflow: hidden; margin: 0; padding: 0; }
        .fs12 { font-size: 12px; }

        .white-bg { padding: 20px; background: rgba(255, 255, 255, 0.6); border-top: 1px solid rgba(0, 0, 0, .125); }
        .gree-prod { margin: 0 auto; padding: 20px; width: 190px; cursor: pointer; }
        .gree-prod:hover { box-shadow: 0 0 20px rgba(0, 0, 0, .125); }
        .gree-prod .prod-img { margin: 0 auto; max-width: 100%; }
        .gree-prod .prod-txt { text-align: center; text-transform: uppercase; }

        .product-info {
            display: inline-block;
            margin-left: -100px;
            padding: 5px;
            width: 200px;
            font-size: 14px;
            border-radius: 5px;
            border: 1px solid rgba(0, 0, 0, .125);
            background: #fff;
            text-align: center;
            text-transform: uppercase;
        }

        @media screen and (max-width: 1366px) {
            .gree-prod { width: 180px; }
        }

        @media screen and (max-width: 1280px) {
            .gree-prod { width: 140px; }
            .gree-prod .prod-txt { font-size: 12px; }
        }

    </style>
</head>
<body>
    <div id="app">
        <div
            class="fixed-top product-info"
            :style="{ top: selectdProductPosition.top + 'px', left: selectdProductPosition.left + 'px' }" >
            {{ intersectedObj.userData.cname }} {{ intersectedObj.name }}
        </div>
        <div
            class="fixed-bottom white-bg"
            v-show="isShowSelectPlaneDom"
            ref="refSelectPlane"
            @mouseenter="removeMouseDownEvent()"
            @mouseleave="addMouseDownEvent()"
            >
            <div class="row justity-content-center">
                <div class="col">
                    <div class="card gree-prod" onclick="handleLoad_CXW200CCS02()">
                        <img class="prod-img" src="./image/cxw-200-ccs02.png" alt="">
                        <div class="prod-txt">烟机<br />cxw-200-ccs02</div>
                    </div>
                </div>
                <div class="col">
                    <div class="card gree-prod" onclick="handleLoad_CXW200CCS01A()">
                        <img class="prod-img" src="./image/cxw-200-ccs01a.png" alt="">
                        <div class="prod-txt">烟机<br />cxw-200-ccs01a</div>
                    </div>
                </div>
                <div class="col">
                    <div class="card gree-prod" onclick="handleLoad_CXW200TCD02()">
                        <img class="prod-img" src="./image/cxw-200-tcd02.png" alt="">
                        <div class="prod-txt">烟机<br />cxw-200-tcd02</div>
                    </div>
                </div>
                <div class="col">
                    <div class="card gree-prod" onclick="handleLoad_CXW200TCD01()">
                        <img class="prod-img" src="./image/cxw-200-tcd01.png" alt="">
                        <div class="prod-txt">烟机<br />cxw-200-tcd01</div>
                    </div>
                </div>
                <div class="col">
                    <div class="card gree-prod" onclick="handleLoad_XZTD105A01()">
                        <img class="prod-img" src="./image/xztd105a-01.png" alt="">
                        <div class="prod-txt">消毒柜<br />xztd105a-01</div>
                    </div>
                </div>
                <div class="col">
                    <div class="card gree-prod" onclick="handleLoad_XZTD105A03()">
                        <img class="prod-img" src="./image/xztd105a-03.png" alt="">
                        <div class="prod-txt">消毒柜<br />xztd105a-03</div>
                    </div>
                </div>
                <div class="col">
                    <div class="card gree-prod" onclick="handleLoad_JZXQS02B()">
                        <img class="prod-img" src="./image/jzx-qs02b.png" alt="">
                        <div class="prod-txt">燃气灶<br />jzx-qs02b</div>
                    </div>
                </div>
                <div class="col">
                    <div class="card gree-prod" onclick="handleLoad_JZXQS03B()">
                        <img class="prod-img" src="./image/jzy-qs03b.png" alt="">
                        <div class="prod-txt">燃气灶<br />jzy-qs03b</div>
                    </div>
                </div>
            </div>
        </div>
        <div v-show="!isShowSelectPlaneDom" class="fixed-bottom text-muted text-center fs12">V0.0.4</div>
    </div>
    <script>
        var vm = new Vue({
            el: "#app",
            data: {
                productList: [
                    { cname: '烟机', name: 'cxw-200-ccs02', type: 'Product', position: [ -150, 160, -43], geometryUrl: './models/cxw-200-ccs02-geometry.fbx', textureUrl: './models/cxw-200-ccs02-texture-1024.jpg' },
                    { cname: '烟机', name: 'cxw-200-ccs01a', type: 'Product', position: [ 180, 160, -43 ], geometryUrl: './models/cxw-200-ccs01a-geometry.fbx', textureUrl: './models/cxw-200-ccs01a-texture-1024.jpg' },
                    { cname: '消毒柜', name: 'xztd105a-01', type: 'Product', position: [ 180, 14, 0.46 ], geometryUrl: './models/xztd105a-01-geometry.fbx', textureUrl: './models/xztd105a-01-texture-1024.jpg' },
                    { cname: '消毒柜', name: 'xztd105a-03', type: 'Product', position: [ 0, 14, 0.46 ], geometryUrl: './models/xztd105a-03-geometry.fbx', textureUrl: './models/xztd105a-03-texture-1024.jpg' },
                    { cname: '燃气灶', name: 'jzx-qs02b', type: 'Product', position: [ 180, 78, 0 ], geometryUrl: './models/jzx-qs02b-geometry.fbx', textureUrl: './models/jzx-qs02b-texture-1024.jpg' },
                ],
                isShowSelectPlaneDom: false,
                selectdProductPosition: { top: 0, left: 0, },
                intersectedObj: {
                    userData: {
                        cname: "",
                    },
                    name: "",
                },
            },
            methods: {
                addMouseDownEvent: function () {
                    console.log('==== addMouseDownEvent ====');
                    document.addEventListener( 'mousedown', onDocumentMouseDown, false );
                },
                removeMouseDownEvent: function () {
                    console.log('==== removeMouseDownEvent ====');
                    document.removeEventListener( 'mousedown', onDocumentMouseDown, false );
                }
            }
        });
    </script>
    <script>
        if ( WEBGL.isWebGLAvailable() === false ) {
    
            document.getElementById("app").appendChild( WEBGL.getWebGLErrorMessage() );
    
        }

        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
        // var camera = new THREE.OrthographicCamera(window.innerWidth / - 2, window.innerWidth / 2, window.innerHeight / 2, window.innerHeight / - 2, 1, 1000);

        var control = new THREE.OrbitControls(camera);
        // control.autoRotate = true;
        control.autoRotateSpeed = 1;
        control.enablePan = false;
        control.enableZoom = false;
        control.minPolarAngle = Math.PI / 3; // 垂直高度上方
        control.maxPolarAngle = Math.PI / 2 - 0.1; // 垂直高度下方
        control.minAzimuthAngle = - Math.PI / 4; // radians
	    control.maxAzimuthAngle = Math.PI / 1000; // radians

        var renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true; // 渲染器开启阴影

        // 挂载节点
        document.getElementById("app").appendChild(renderer.domElement);

        var stats = new Stats();
        // stats.setMode(1);
        stats.domElement.style.position = 'absolute';
        stats.domElement.left = '0px';
        stats.domElement.top = '0px';
        document.getElementById("app").appendChild(stats.domElement);

        var raycaster = new THREE.Raycaster();
        var mouse = new THREE.Vector2(); // 鼠标移动位置
        var intersectedObj; // 用户选中对象

        var ambientLight = new THREE.AmbientLight( 0xffffff );
        ambientLight.name = "ambient-light";
        scene.add(ambientLight);

        var directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);

        directionalLight.shadow.camera.near = 20; //产生阴影的最近距离
        directionalLight.shadow.camera.far = 1000; //产生阴影的最远距离
        directionalLight.shadow.camera.left = -1000; //产生阴影距离位置的最左边位置
        directionalLight.shadow.camera.right = 1000; //最右边
        directionalLight.shadow.camera.top = 1000; //最上边
        directionalLight.shadow.camera.bottom = -1000; //最下面

        //这两个值决定使用多少像素生成阴影 默认512
        directionalLight.shadow.mapSize.height = 1024;
        directionalLight.shadow.mapSize.width = 1024;

        //告诉平行光需要开启阴影投射
        directionalLight.castShadow = true;

        directionalLight.position.set(0, 500, 0);
        directionalLight.name = "directional-Light";
        scene.add( directionalLight );

        var loader = new THREE.FBXLoader();

        function loadModelList( modelList ) {
            for (let index = 0; index < modelList.length; index++) {
                const modelItem = modelList[index];
                
                loader.load( modelItem.geometryUrl, function (object) {

                    // bugfixed
                    object.children.forEach(child => {
                        if (child.material) {
                            child.material.side = THREE.DoubleSide;
                            var texture = new THREE.TextureLoader().load( modelItem.textureUrl );
                            child.material.map = texture;
                        }
                        //设置模型生成阴影并接收阴影
                        child.castShadow = true;
                        // child.receiveShadow = true;
                    });

                    object.name = modelItem.name;
                    var x = modelItem.position[0];
                    var y = modelItem.position[1];
                    var z = modelItem.position[2];
                    object.position.set( x, y, z );
                    object.userData = { cname: modelItem.cname, type: modelItem.type };
                    scene.add(object);

                });
            }
        }

        var cubeCamera1 = new THREE.CubeCamera( 1, 10000, 128 );
        var cubeCamera2 = new THREE.CubeCamera( 1, 10000, 128 );
        function loadFbxModels() {
            
            loader.load('./models/jzy-qs03b-geometry.fbx', function (object) {
    
                // bugfixed
                object.children.forEach(child => {
                    if (child.material[1]) {
                        child.material[0].side = THREE.DoubleSide;
                        child.material[1].side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/jzy-qs03b-texture-1024.jpg');
                        child.material[0].map = texture;
                        child.material[1].map = texture;
                        // child.rotation.y = THREE.Math.degToRad( 180 );
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });
    
                object.name = "jzy-qs03b";
                object.position.set(0, 78, 0);
                object.userData = {  cname: '燃气灶', type: "Product" };
                scene.add(object);
    
            });

            loader.load('./models/cxw-200-tcd01-geometry.fbx', function (object) {

                var cubeCamera = cubeCamera1;
                // var cubeCamera = new THREE.CubeCamera( 1, 10000, 128 );
                cubeCamera.name = "cubeCamera-cxw-200-tcd01";
                scene.add(cubeCamera);

                // bugfixed
                object.children.forEach(child => {
                    if (child.material[0]) {
                        var material = new THREE.MeshLambertMaterial({ envMap: cubeCamera.renderTarget.texture });
                        child.material[0] = material;
                        child.material[0].side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/cxw-200-tcd01-texture-1024.jpg');
                        child.material[0].map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });
    
                object.name = "cxw-200-tcd01";
                object.rotation.y = THREE.Math.degToRad( -90 );
                object.position.set( 350, 160, 280 );
                object.userData = { cname: '烟机', type: "Product" };
                scene.add(object);

                cubeCamera.position.copy( object.position );
                cubeCamera.update( renderer, scene );

            });

            loader.load('./models/cxw-200-tcd02-geometry.fbx', function (object) {

                var cubeCamera = cubeCamera2;
                // var cubeCamera = new THREE.CubeCamera( 1, 10000, 128 );
                cubeCamera.name = "cubeCamera-cxw-200-tcd01";
                scene.add(cubeCamera);

                // bugfixed
                object.children.forEach(child => {
                    if (child.material[0]) {
                        var material = new THREE.MeshLambertMaterial({ envMap: cubeCamera.renderTarget.texture });
                        child.material[0] = material;
                        child.material[0].side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/cxw-200-tcd02-texture-1024.jpg');
                        child.material[0].map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });
    
                object.name = "cxw-200-tcd02";
                object.position.set(0, 160, 2);
                object.userData = {  cname: '烟机', type: "Product" };
                scene.add(object);

                cubeCamera.position.copy( object.position );
                cubeCamera.update( renderer, scene );

            });
            
        }

        function createSarks() {
            
            loader.load('./models/sark-geometry.fbx', function (object) {
    
                // bugfixed
                object.children.forEach(child => {
                    if (child.material) {
                        child.material.side = THREE.DoubleSide;
                        // var texture = new THREE.TextureLoader().load('./models/sark-texture-1024.jpg');
                        // child.material.map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });
    
                object.name = "sark-geometry";
                object.position.set(350, 0, 200);
                object.userData = { type: "Room" };
                scene.add(object);
    
                // 复制柜子
                var obj3d = object.clone();
                obj3d.position.z += 59;
                obj3d.userData = { type: "Room" };
                scene.add(obj3d);
    
                // 复制柜子
                object = obj3d;
                var obj3d = object.clone();
                obj3d.position.z += 59;
                obj3d.userData = { type: "Room" };
                scene.add(obj3d);
    
                // 复制柜子
                object = obj3d;
                var obj3d = object.clone();
                obj3d.position.z += 59;
                obj3d.userData = { type: "Room" };
                scene.add(obj3d);
    
            });

        }

        function createPlane() {
            // 地面
            var geometry = new THREE.PlaneGeometry(1500, 1500);
            
            var texture = new THREE.TextureLoader().load('./texture/floor.jpg');
            texture.wrapS = THREE.RepeatWrapping;
            texture.wrapT = THREE.RepeatWrapping;
            texture.repeat.set( 15, 15 );
            var material = new THREE.MeshLambertMaterial({ color: 0xbbbbbb, map: texture });

            // var material = new THREE.MeshLambertMaterial({ color: 0xbbbbbb });

            material.side = THREE.DoubleSide;
            var plane = new THREE.Mesh(geometry, material);
            plane.rotation.x = -Math.PI / 2;
            // plane.position.y = -70;
            plane.receiveShadow = true;
            plane.name = "ground";
            plane.userData = { type: "Room" };
            scene.add(plane);
        }

        function createCube() {
            var geometry = new THREE.BoxGeometry( 200, 100, 100 );
            var material = new THREE.MeshLambertMaterial({ color: 0xcecece });
            var mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(0, 55, 0);
            mesh.castShadow = true;
            mesh.userData = { type: "Room" };
            scene.add(mesh);
        }

        function createCubeRoom() {
            var geometry = new THREE.BoxGeometry( 1300, 1300, 1300 );
            var material = new THREE.MeshLambertMaterial({ color: 0xeeeeee, side: THREE.DoubleSide });
            var mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(0, 0, 0);
            // mesh.castShadow = true;
            mesh.name = "cube-room";
            mesh.userData = { type: "Room" };
            scene.add(mesh);
        }

        function createRoomTop() {
            var geometry = new THREE.BoxGeometry( 1300, 10, 1300 );
            var material = new THREE.MeshLambertMaterial({ color: 0xeeeeee, side: THREE.DoubleSide });
            var mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(0, 271, 0);
            // mesh.castShadow = true;
            mesh.name = "room-top";
            mesh.userData = { type: "Room" };
            scene.add(mesh);
        }

        function createKitchenRoom() {
            loader.load('./models/kitchen-geometry.fbx', function (object) {
                object.children.forEach(child => {
                    if (child.material) {
                        var texture = new THREE.TextureLoader().load('./models/kitchen-texture.png');
                        child.material.map = texture;
                    }
                })
                object.name = "kitchen-room";
                object.userData = { type: "Room" };
                scene.add(object);
            });
        }

        function onDocumentMouseDown( event ) {

            console.log('==== onDocumentMouseDown ====');

            event.preventDefault();

            mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
            mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            
            var intersectObjects = [];
            for (let index = 0; index < scene.children.length; index++) {
                const object = scene.children[index];
                // 选择产品Product
                if ( object instanceof THREE.Group && object.userData.type == "Product") {
                    object.children[0].name = object.name;
                    intersectObjects.push(object.children[0]);
                }
            }

            var intersects = raycaster.intersectObjects( intersectObjects );
            var intersected = intersects[0];

            // 处理点击模型事件
            handleSelectObj(intersected);

        }

        document.addEventListener( 'mousedown', onDocumentMouseDown, false );

        function handleSelectObj( intersected ) {
            if (intersected) {
                vm.$data.isShowSelectPlaneDom = true;

                intersectedObj = intersected.object.parent;
                var { x, y, z } = intersectedObj.position;
                camera.lookAt(x, y, z);

                // control.target = intersectedObj.position;

                // var coords = { offsetGlobalCamera: offsetGlobalCamera, widthGlobalCamera: widthGlobalCamera };
                new TWEEN.Tween(control.target)
                    .to({
                        x: intersectedObj.position.x,
                        // y: intersectedObj.position.y,
                        // z: intersectedObj.position.z
                    }, 1000)
                    .onUpdate(function () {
                        control.enableRotate = false;
                    })
                    .onComplete(function () {
                        control.enableRotate = true;
                    })
                    .easing(TWEEN.Easing.Linear.None)
                    .start();

            } else {
                vm.$data.isShowSelectPlaneDom = false;
            }
        }

        function handleLoad_CXW200CCS02() {

            loader.load('./models/cxw-200-ccs02-geometry.fbx', function (object) {

                // bugfixed
                object.children.forEach(child => {
                    if (child.material) {
                        child.material.side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/cxw-200-ccs02-texture-1024.jpg');
                        child.material.map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });

                object.name = "cxw-200-ccs02";
                object.userData = { cname: '烟机' };

                // 复制位置和替换
                copyPositionAndReplace(object);

            });
        }

        function handleLoad_CXW200CCS01A() {

            loader.load('./models/cxw-200-ccs01a-geometry.fbx', function (object) {

                // bugfixed
                object.children.forEach(child => {
                    if (child.material) {
                        child.material.side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/cxw-200-ccs01a-texture-1024.jpg');
                        child.material.map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });

                object.name = "cxw-200-ccs01a";
                object.userData = { cname: '烟机' };

                // 复制位置和替换
                copyPositionAndReplace(object);

            });
        }

        function handleLoad_CXW200TCD02() {
            
            loader.load('./models/cxw-200-tcd02-geometry.fbx', function (object) {

                // bugfixed
                object.children.forEach(child => {
                    if (child.material[0]) {
                        child.material[0].side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/cxw-200-tcd02-texture-1024.jpg');
                        child.material[0].map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });

                object.name = "cxw-200-tcd02";
                object.userData = { cname: '烟机' };

                // 复制位置和替换
                copyPositionAndReplace(object);

            });
        }

        function handleLoad_CXW200TCD01() {
            
            loader.load('./models/cxw-200-tcd01-geometry.fbx', function (object) {

                // bugfixed
                object.children.forEach(child => {
                    if (child.material[0]) {
                        child.material[0].side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/cxw-200-tcd01-texture-1024.jpg');
                        child.material[0].map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });

                object.name = "cxw-200-tcd01";
                object.userData = { cname: '烟机' };

                // 复制位置和替换
                copyPositionAndReplace(object);

            });
        }

        function handleLoad_XZTD105A01() {
            
            loader.load('./models/xztd105a-01-geometry.fbx', function (object) {

                // bugfixed
                object.children.forEach(child => {
                    if (child.material) {
                        child.material.side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/xztd105a-01-texture-1024.jpg');
                        child.material.map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });

                object.name = "xztd105a-01";
                object.userData = { cname: '消毒柜' };

                // 复制位置和替换
                copyPositionAndReplace(object);

            });
        }

        function handleLoad_XZTD105A03() {
            
            loader.load('./models/xztd105a-03-geometry.fbx', function (object) {

                // bugfixed
                object.children.forEach(child => {
                    if (child.material) {
                        child.material.side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/xztd105a-03-texture-1024.jpg');
                        child.material.map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });

                object.name = "xztd105a-03";
                object.userData = { cname: '消毒柜' };

                // 复制位置和替换
                copyPositionAndReplace(object);

            });
        }

        function handleLoad_JZXQS02B() {

            loader.load('./models/jzx-qs02b-geometry.fbx', function (object) {

                // bugfixed
                object.children.forEach(child => {
                    if (child.material) {
                        child.material.side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/jzx-qs02b-texture-1024.jpg');
                        child.material.map = texture;
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });

                object.name = "jzx-qs02b";
                object.userData = { cname: '燃气灶' };

                // 复制位置和替换
                copyPositionAndReplace(object);

            });
        }

        function handleLoad_JZXQS03B() {

            loader.load('./models/jzy-qs03b-geometry.fbx', function (object) {

                // bugfixed
                object.children.forEach(child => {
                    if (child.material[1]) {
                        child.material[0].side = THREE.DoubleSide;
                        child.material[1].side = THREE.DoubleSide;
                        var texture = new THREE.TextureLoader().load('./models/jzy-qs03b-texture-1024.jpg');
                        child.material[0].map = texture;
                        child.material[1].map = texture;
                        // child.rotation.y = THREE.Math.degToRad( 180 );
                    }
                    //设置模型生成阴影并接收阴影
                    child.castShadow = true;
                    // child.receiveShadow = true;
                });

                object.name = "jzy-qs03b";
                object.userData = { cname: '燃气灶' };

                // 复制位置和替换
                copyPositionAndReplace(object);

            });
        }


        // 复制位置和替换
        function copyPositionAndReplace(object) {
            // 复制位置
            var { x, y, z } = intersectedObj.position;
            object.position.set(x, y, z);
            object.userData = Object.assign({}, object.userData, { type: "Product" });
            scene.add(object);

            scene.remove(intersectedObj); // 删除选中对象
            intersectedObj = object;
        }

        // 设置场景背景
        function initSceneBG() {

            var envMap = new THREE.CubeTextureLoader()
                .setPath( './examples/textures/cube/skyboxsun25deg/')
                .load( [ 'px.jpg', 'nx.jpg', 'py.jpg', 'ny.jpg', 'pz.jpg', 'nz.jpg' ] );

            scene.background = envMap;

        }

        // 屏幕改变
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.render( scene, camera );
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        window.addEventListener('resize', onWindowResize, false);

        // 摄像机位置
        camera.position.set( -20, 100, 450);
        // 控制组件看向的位置
        control.target = new THREE.Vector3( 200, 0, -10 );

        // 设置提示位置
        function setProdTipPosition() {
            if (intersectedObj === undefined) {
                return;
            }
            //获取到窗口的一半高度和一半宽度
            let halfWidth = window.innerWidth / 2;
            let halfHeight = window.innerHeight / 2;

            let vector = intersectedObj.position.clone().project(camera);

            //修改第一个的div的位置
            vm.$data.selectdProductPosition = {
                left: vector.x * halfWidth + halfWidth,
                top: -vector.y * halfHeight + halfHeight
            };
            vm.$data.intersectedObj = intersectedObj;
        }

        // 每桢渲染
        function updateRender() {
            setProdTipPosition();
        }

        var animate = function () {
            requestAnimationFrame(animate);
            control.update();
            TWEEN.update();
            stats.update();

            updateRender();

            renderer.render(scene, camera);
        }
        initSceneBG();
        // createCube();
        createPlane();
        createKitchenRoom();
        createCubeRoom();
        createRoomTop();
        createSarks();
        loadModelList(vm.$data.productList);
        loadFbxModels();
        animate();

        // TODO: 导入完成后update cubeCamera
        var countInterval = 0;
        var _time = setInterval(function () {

            console.log('==== setInterval update cubeCamera ====');
            cubeCamera1.update( renderer, scene );
            cubeCamera2.update( renderer, scene );

            countInterval += 1;
            if (countInterval === 5) {
                clearInterval(_time);
                console.log('==== clearInterval update cubeCamera ====');
            }
        }, 500);
        

        document.addEventListener( 'dragover', function ( event ) {

            event.preventDefault();
            event.dataTransfer.dropEffect = 'copy';

        }, false );

        document.addEventListener( 'drop', function ( event ) {

            event.preventDefault();

            console.log( event.dataTransfer.files );

        }, false );
    </script>
</body>
</html>